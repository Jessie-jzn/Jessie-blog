(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{446:function(t,s,a){"use strict";a.r(s);var e=a(2),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"reactçš„æ ¸å¿ƒæ€æƒ³"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reactçš„æ ¸å¿ƒæ€æƒ³"}},[t._v("#")]),t._v(" Reactçš„æ ¸å¿ƒæ€æƒ³")]),t._v(" "),s("p",[t._v("å†…å­˜ä¸­ç»´æŠ¤ä¸€é¢—è™šæ‹ŸDOMæ ‘ï¼Œæ•°æ®å˜åŒ–æ—¶ï¼ˆsetStateï¼‰ï¼Œè‡ªåŠ¨æ›´æ–°è™šæ‹Ÿ DOMï¼Œå¾—åˆ°ä¸€é¢—æ–°æ ‘ï¼Œç„¶å Diff æ–°è€è™šæ‹Ÿ DOM æ ‘ï¼Œæ‰¾åˆ°æœ‰å˜åŒ–çš„éƒ¨åˆ†ï¼Œå¾—åˆ°ä¸€ä¸ª Change(Patch)ï¼Œå°†è¿™ä¸ª Patch åŠ å…¥é˜Ÿåˆ—ï¼Œæœ€ç»ˆæ‰¹é‡æ›´æ–°è¿™äº› Patch åˆ° DOM ä¸­ã€‚")]),t._v(" "),s("h2",{attrs:{id:"react15-vs-react16"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#react15-vs-react16"}},[t._v("#")]),t._v(" React15 VS React16")]),t._v(" "),s("p",[t._v("åœ¨react16ä¹‹å‰çš„ç‰ˆæœ¬é‡‡ç”¨çš„é€’å½’çš„éå†æ–¹å¼ï¼Œè¿™ç§ä¹Ÿè¢«æˆä¸º "),s("strong",[t._v("Stack Reconcilerã€‚"),s("strong",[t._v("ä¸€æ—¦ä»»åŠ¡å¼€å§‹è¿›è¡Œï¼Œå°±")]),t._v("æ— æ³•ä¸­æ–­")]),t._v("ï¼Œé‚£ä¹ˆ js å°†ä¸€ç›´å ç”¨ä¸»çº¿ç¨‹ï¼Œä¸€ç›´è¦ç­‰åˆ°æ•´æ£µ Virtual DOM æ ‘è®¡ç®—å®Œæˆä¹‹åï¼Œæ‰èƒ½æŠŠæ‰§è¡Œæƒäº¤ç»™æ¸²æŸ“å¼•æ“ï¼Œé‚£ä¹ˆè¿™å°±ä¼šå¯¼è‡´ä¸€äº›ç”¨æˆ·äº¤äº’ã€åŠ¨ç”»ç­‰ä»»åŠ¡æ— æ³•ç«‹å³å¾—åˆ°å¤„ç†ï¼Œå°±ä¼šæœ‰å¡é¡¿ï¼Œéå¸¸çš„å½±å“ç”¨æˆ·ä½“ã€‚")]),t._v(" "),s("h3",{attrs:{id:"è§£å†³æ–¹æ³•"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#è§£å†³æ–¹æ³•"}},[t._v("#")]),t._v(" "),s("strong",[t._v("è§£å†³æ–¹æ³•")])]),t._v(" "),s("p",[s("strong",[t._v("æŠŠæ¸²æŸ“æ›´æ–°è¿‡ç¨‹æ‹†åˆ†æˆå¤šä¸ªå­ä»»åŠ¡ï¼Œæ¯æ¬¡åªåšä¸€å°éƒ¨åˆ†ï¼Œåšå®Œçœ‹æ˜¯å¦è¿˜æœ‰å‰©ä½™æ—¶é—´ï¼Œå¦‚æœæœ‰ç»§ç»­ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼›å¦‚æœæ²¡æœ‰ï¼ŒæŒ‚èµ·å½“å‰ä»»åŠ¡ï¼Œå°†æ—¶é—´æ§åˆ¶æƒäº¤ç»™ä¸»çº¿ç¨‹ï¼Œç­‰ä¸»çº¿ç¨‹ä¸å¿™çš„æ—¶å€™åœ¨ç»§ç»­æ‰§è¡Œã€‚")])]),t._v(" "),s("blockquote",[s("p",[t._v("åˆä½œå¼è°ƒåº¦ä¸»è¦å°±æ˜¯ç”¨æ¥åˆ†é…ä»»åŠ¡çš„ï¼Œå½“æœ‰æ›´æ–°ä»»åŠ¡æ¥çš„æ—¶å€™ï¼Œä¸ä¼šé©¬ä¸Šå»åš Diff æ“ä½œï¼Œè€Œæ˜¯å…ˆæŠŠå½“å‰çš„æ›´æ–°é€å…¥ä¸€ä¸ª Update Queue ä¸­ï¼Œç„¶åäº¤ç»™ "),s("strong",[t._v("Scheduler")]),t._v(" å»å¤„ç†ï¼ŒScheduler ä¼šæ ¹æ®å½“å‰ä¸»çº¿ç¨‹çš„ä½¿ç”¨æƒ…å†µå»å¤„ç†è¿™æ¬¡ Updateã€‚ä¸ºäº†å®ç°è¿™ç§ç‰¹æ€§ï¼Œä½¿ç”¨äº†"),s("code",[t._v("requestIdelCallback")]),t._v("APIã€‚å¯¹äºä¸æ”¯æŒè¿™ä¸ªAPI çš„æµè§ˆå™¨ï¼ŒReact ä¼šåŠ ä¸Š pollyfillã€‚")]),t._v(" "),s("p",[t._v("**"),s("code",[t._v("window.requestIdleCallback()")]),t._v("**æ–¹æ³•æ’å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°†åœ¨æµè§ˆå™¨ç©ºé—²æ—¶æœŸè¢«è°ƒç”¨ã€‚è¿™ä½¿å¼€å‘è€…èƒ½å¤Ÿåœ¨ä¸»äº‹ä»¶å¾ªç¯ä¸Šæ‰§è¡Œåå°å’Œä½ä¼˜å…ˆçº§å·¥ä½œï¼Œè€Œä¸ä¼šå½±å“å»¶è¿Ÿå…³é”®äº‹ä»¶ï¼Œå¦‚åŠ¨ç”»å’Œè¾“å…¥å“åº”ã€‚å‡½æ•°ä¸€èˆ¬ä¼šæŒ‰å…ˆè¿›å…ˆè°ƒç”¨çš„é¡ºåºæ‰§è¡Œï¼Œç„¶è€Œï¼Œå¦‚æœå›è°ƒå‡½æ•°æŒ‡å®šäº†æ‰§è¡Œè¶…æ—¶æ—¶é—´"),s("code",[t._v("timeout")]),t._v("ï¼Œåˆ™æœ‰å¯èƒ½ä¸ºäº†åœ¨è¶…æ—¶å‰æ‰§è¡Œå‡½æ•°è€Œæ‰“ä¹±æ‰§è¡Œé¡ºåº")])]),t._v(" "),s("h2",{attrs:{id:"fiberçš„å®šä¹‰"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fiberçš„å®šä¹‰"}},[t._v("#")]),t._v(" Fiberçš„å®šä¹‰")]),t._v(" "),s("blockquote",[s("p",[t._v("ä¹Ÿç§°"),s("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fwww.liaoxuefeng.com%2Fwiki%2F897692888725344%2F923057403198272",target:"_blank",rel:"noopener noreferrer"}},[t._v("åç¨‹"),s("OutboundLink")],1),t._v("ã€æˆ–è€…çº¤ç¨‹ã€‚"),s("strong",[t._v("ğŸ”´Reactæ¸²æŸ“çš„è¿‡ç¨‹å¯ä»¥è¢«ä¸­æ–­ï¼Œå¯ä»¥å°†æ§åˆ¶æƒäº¤å›æµè§ˆå™¨ï¼Œè®©ä½ç»™é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œæµè§ˆå™¨ç©ºé—²åå†æ¢å¤æ¸²æŸ“ã€‚")]),t._v("\nå®ƒçš„ç‰¹æ€§å°±æ˜¯"),s("strong",[t._v("æ—¶é—´åˆ†ç‰‡(time slicing)å’Œæš‚åœ(supense)")])])]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("æµè§ˆå™¨æ²¡æœ‰æŠ¢å çš„æ¡ä»¶, æ‰€ä»¥Reactåªèƒ½ç”¨è®©å‡ºæœºåˆ¶?")])])]),t._v(" "),s("p",[t._v("ä¸€æ˜¯æµè§ˆå™¨ä¸­æ²¡æœ‰ç±»ä¼¼è¿›ç¨‹çš„æ¦‚å¿µï¼Œâ€™ä»»åŠ¡â€˜ä¹‹é—´çš„ç•Œé™å¾ˆæ¨¡ç³Šï¼Œæ²¡æœ‰ä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥ä¸å…·å¤‡ä¸­æ–­/æ¢å¤çš„æ¡ä»¶ã€‚")]),t._v(" "),s("p",[t._v("äºŒæ˜¯æ²¡æœ‰æŠ¢å çš„æœºåˆ¶ï¼Œæˆ‘ä»¬æ— æ³•ä¸­æ–­ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œçš„ç¨‹åºã€‚")]),t._v(" "),s("p",[t._v("å®ƒæœ‰æ›´ä¸€ä¸ªä¸“ä¸šçš„åè¯ï¼š"),s("strong",[s("a",{attrs:{href:"https://juejin.cn/post/6844903874692661255#heading-7",target:"_blank",rel:"noopener noreferrer"}},[t._v("åˆä½œå¼è°ƒåº¦(Cooperative Scheduling)"),s("OutboundLink")],1)]),t._v(", ç›¸å¯¹åº”çš„æœ‰"),s("strong",[t._v("æŠ¢å å¼è°ƒåº¦(Preemptive Scheduling)")])]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("æ€ä¹ˆç¡®å®šæœ‰é«˜ä¼˜å…ˆä»»åŠ¡è¦å¤„ç†ï¼Œå³ä»€ä¹ˆæ—¶å€™è®©å‡ºï¼Ÿ")])])]),t._v(" "),s("p",[t._v("æµè§ˆå™¨æä¾›äº†ç›¸å…³çš„æ¥å£ â€”â€”Â "),s("code",[t._v("[requestIdleCallback](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindow%2FrequestIdleCallback)")]),t._v("Â APIã€‚"),s("strong",[t._v("è®©æµè§ˆå™¨åœ¨'æœ‰ç©º'çš„æ—¶å€™å°±æ‰§è¡Œæˆ‘ä»¬çš„å›è°ƒï¼Œè¿™ä¸ªå›è°ƒä¼šä¼ å…¥ä¸€ä¸ªæœŸé™ï¼Œè¡¨ç¤ºæµè§ˆå™¨æœ‰å¤šå°‘æ—¶é—´ä¾›æˆ‘ä»¬æ‰§è¡Œ, ä¸ºäº†ä¸è€½è¯¯äº‹ï¼Œæˆ‘ä»¬æœ€å¥½åœ¨è¿™ä¸ªæ—¶é—´èŒƒå›´å†…æ‰§è¡Œå®Œæ¯•ã€‚")])]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[t._v("window"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestIdleCallback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("callback")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("dealine")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" IdleDeadline")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  option"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("timeout")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" number"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IdleDealine")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("didTimeout")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" boolean "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¡¨ç¤ºä»»åŠ¡æ‰§è¡Œæ˜¯å¦è¶…è¿‡çº¦å®šæ—¶é—´")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeRemaining")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" DOMHighResTimeStamp "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä»»åŠ¡å¯ä¾›æ‰§è¡Œçš„å‰©ä½™æ—¶é—´")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[s("strong",[t._v("æµè§ˆå™¨åœ¨æ¯ä¸€å¸§å†…éƒ½åšäº†ä»€ä¹ˆï¼Ÿã€ç†æƒ³çš„ä¸€å¸§æ—¶é—´æ˜¯16ms(1000ms / 60)ã€‘")])]),t._v(" "),s("ul",[s("li",[t._v("å¤„ç†ç”¨æˆ·è¾“å…¥äº‹ä»¶")]),t._v(" "),s("li",[t._v("Javascriptæ‰§è¡Œ")]),t._v(" "),s("li",[t._v("requestAnimation è°ƒç”¨")]),t._v(" "),s("li",[t._v("å¸ƒå±€ Layout")]),t._v(" "),s("li",[t._v("ç»˜åˆ¶ Paint")])]),t._v(" "),s("p",[t._v("å¦‚æœæµè§ˆå™¨å¤„ç†å®Œä¸Šè¿°çš„ä»»åŠ¡(å¸ƒå±€å’Œç»˜åˆ¶ä¹‹å)ï¼Œè¿˜æœ‰ç›ˆä½™æ—¶é—´ï¼Œæµè§ˆå™¨å°±ä¼šè°ƒç”¨Â "),s("code",[t._v("requestIdleCallback")]),t._v("çš„å›è°ƒã€‚")]),t._v(" "),s("p",[s("strong",[t._v("ä½†æ˜¯åœ¨æµè§ˆå™¨ç¹å¿™çš„æ—¶å€™ï¼Œå¯èƒ½ä¸ä¼šæœ‰ç›ˆä½™æ—¶é—´ï¼Œè¿™æ—¶å€™"),s("code",[t._v("requestIdleCallback")]),t._v("å›è°ƒå¯èƒ½å°±ä¸ä¼šè¢«æ‰§è¡Œã€‚ ä¸ºäº†é¿å…é¥¿æ­»ï¼Œå¯ä»¥é€šè¿‡requestIdleCallbackçš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šä¸€ä¸ªè¶…æ—¶æ—¶é—´ã€‚")])]),t._v(" "),s("p",[t._v("ç›®å‰Â "),s("code",[t._v("requestIdleCallback")]),t._v("åªæœ‰Chromeæ”¯æŒã€‚æ‰€ä»¥ç›®å‰ Reactè‡ªå·±å®ç°äº†ä¸€ä¸ªã€‚å®ƒåˆ©ç”¨"),s("code",[t._v("[MessageChannel](https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FMessageChannel)")]),t._v("æ¨¡æ‹Ÿå°†å›è°ƒå»¶è¿Ÿåˆ°'ç»˜åˆ¶æ“ä½œ'ä¹‹åæ‰§è¡Œã€‚")]),t._v(" "),s("p",[s("strong",[t._v("ä»»åŠ¡ä¼˜å…ˆçº§")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Immediate")]),t._v("(-1) - è¿™ä¸ªä¼˜å…ˆçº§çš„ä»»åŠ¡ä¼šåŒæ­¥æ‰§è¡Œ, æˆ–è€…è¯´è¦é©¬ä¸Šæ‰§è¡Œä¸”ä¸èƒ½ä¸­æ–­")]),t._v(" "),s("li",[s("code",[t._v("UserBlocking")]),t._v("(250ms) è¿™äº›ä»»åŠ¡ä¸€èˆ¬æ˜¯ç”¨æˆ·äº¤äº’çš„ç»“æœ, éœ€è¦å³æ—¶å¾—åˆ°åé¦ˆ")]),t._v(" "),s("li",[s("code",[t._v("Normal")]),t._v(" (5s) åº”å¯¹å“ªäº›ä¸éœ€è¦ç«‹å³æ„Ÿå—åˆ°çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚")]),t._v(" "),s("li",[s("code",[t._v("Low")]),t._v(" (10s) è¿™äº›ä»»åŠ¡å¯ä»¥æ”¾åï¼Œä½†æ˜¯æœ€ç»ˆåº”è¯¥å¾—åˆ°æ‰§è¡Œ. ä¾‹å¦‚åˆ†æé€šçŸ¥")]),t._v(" "),s("li",[s("code",[t._v("Idle")]),t._v(" (æ²¡æœ‰è¶…æ—¶æ—¶é—´) ä¸€äº›æ²¡æœ‰å¿…è¦åšçš„ä»»åŠ¡ (e.g. æ¯”å¦‚éšè—çš„å†…å®¹), å¯èƒ½ä¼šè¢«é¥¿æ­»")])]),t._v(" "),s("h2",{attrs:{id:"fiberç›¸å…³çš„åŸºç¡€æ¦‚å¿µ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fiberç›¸å…³çš„åŸºç¡€æ¦‚å¿µ"}},[t._v("#")]),t._v(" Fiberç›¸å…³çš„åŸºç¡€æ¦‚å¿µ")]),t._v(" "),s("h3",{attrs:{id:"work"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#work"}},[t._v("#")]),t._v(" work")]),t._v(" "),s("p",[t._v("åœ¨ React Reconciliation è¿‡ç¨‹ä¸­å‡ºç°çš„å„ç§å¿…é¡»æ‰§è¡Œè®¡ç®—çš„æ´»åŠ¨ï¼Œæ¯”å¦‚ state updateï¼Œprops update æˆ– refs update ç­‰ï¼Œè¿™äº›æ´»åŠ¨æˆ‘ä»¬å¯ä»¥ç»Ÿä¸€ç§°ä¹‹ä¸º workã€‚")]),t._v(" "),s("h3",{attrs:{id:"fiber-å¯¹è±¡"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#fiber-å¯¹è±¡"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Fiber å¯¹è±¡")])]),t._v(" "),s("blockquote",[s("p",[t._v("æ¯ä¸€ä¸ª React å…ƒç´ å¯¹åº”ä¸€ä¸ª fiber å¯¹è±¡ï¼Œä¸€ä¸ª fiber å¯¹è±¡é€šå¸¸æ˜¯è¡¨å¾ work çš„ä¸€ä¸ªåŸºæœ¬å•å…ƒã€‚fiber å¯¹è±¡æœ‰å‡ ä¸ªå±æ€§ï¼Œè¿™äº›å±æ€§æŒ‡å‘å…¶ä»– fiber å¯¹è±¡ã€‚")])]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[t._v("Fiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è·Ÿå½“å‰Fiberç›¸å…³æœ¬åœ°çŠ¶æ€ï¼ˆæ¯”å¦‚æµè§ˆå™¨ç¯å¢ƒå°±æ˜¯DOMèŠ‚ç‚¹ï¼‰")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("stateNode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å•é“¾è¡¨æ ‘ç»“æ„")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŒ‡å‘ä»–åœ¨FiberèŠ‚ç‚¹æ ‘ä¸­çš„`parent`ï¼Œç”¨æ¥åœ¨å¤„ç†å®Œè¿™ä¸ªèŠ‚ç‚¹ä¹‹åå‘ä¸Šè¿”å›")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("child")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŒ‡å‘è‡ªå·±çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("sibling")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŒ‡å‘è‡ªå·±çš„å…„å¼Ÿç»“æ„ï¼Œå…„å¼ŸèŠ‚ç‚¹çš„returnæŒ‡å‘åŒä¸€ä¸ªçˆ¶èŠ‚ç‚¹")]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ›´æ–°ç›¸å…³")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("pendingProps")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ–°çš„å˜åŠ¨å¸¦æ¥çš„æ–°çš„props")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("memoizedProps")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ä¸Šä¸€æ¬¡æ¸²æŸ“å®Œæˆä¹‹åçš„props")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("updateQueue")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" UpdateQueue"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("any")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v(" | null,  // è¯¥Fiberå¯¹åº”çš„ç»„ä»¶äº§ç”Ÿçš„Updateä¼šå­˜æ”¾åœ¨è¿™ä¸ªé˜Ÿåˆ—é‡Œé¢\n  memoizedState: any, // ä¸Šä¸€æ¬¡æ¸²æŸ“çš„æ—¶å€™çš„state\n    \n  // Scheduler ç›¸å…³\n  expirationTime: ExpirationTime,  // ä»£è¡¨ä»»åŠ¡åœ¨æœªæ¥çš„å“ªä¸ªæ—¶é—´ç‚¹åº”è¯¥è¢«å®Œæˆï¼Œä¸åŒ…æ‹¬ä»–çš„å­æ ‘äº§ç”Ÿçš„ä»»åŠ¡\n  // å¿«é€Ÿç¡®å®šå­æ ‘ä¸­æ˜¯å¦æœ‰ä¸åœ¨ç­‰å¾…çš„å˜åŒ–\n  childExpirationTime: ExpirationTime,\n    \n // åœ¨Fiberæ ‘æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªFiberéƒ½ä¼šæœ‰ä¸€ä¸ªè·Ÿå…¶å¯¹åº”çš„Fiber\n  // æˆ‘ä»¬ç§°ä»–ä¸º`current <==> workInProgress`\n  // åœ¨æ¸²æŸ“å®Œæˆä¹‹åä»–ä»¬ä¼šäº¤æ¢ä½ç½®\n  alternate: Fiber | null,\n\n  // Effect ç›¸å…³çš„\n  effectTag: SideEffectTag, // ç”¨æ¥è®°å½•Side Effect\n  nextEffect: Fiber | null, // å•é“¾è¡¨ç”¨æ¥å¿«é€ŸæŸ¥æ‰¾ä¸‹ä¸€ä¸ªside effect\n  firstEffect: Fiber | null,  // å­æ ‘ä¸­ç¬¬ä¸€ä¸ªside effect\n  lastEffect: Fiber | null, // å­æ ‘ä¸­æœ€åä¸€ä¸ªside effect\n  ....\n};\n")])])])]),s("p",[t._v("åˆ›å»ºä¸€ä¸ªfiberå¯¹è±¡")]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createFiberFromElement")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("element")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ReactElement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" TypeOfMode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("expirationTime")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ExpirationTime")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Fiber "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createFiberFromTypeAndProps")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pendingProps"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" owner"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" expirationTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" fiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"worktag"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#worktag"}},[t._v("#")]),t._v(" "),s("strong",[t._v("workTag")])]),t._v(" "),s("blockquote",[s("p",[t._v("fiber å¯¹è±¡çš„ tag å±æ€§å€¼ï¼Œç§°ä½œ workTagï¼Œç”¨äºæ ‡è¯†ä¸€ä¸ª React å…ƒç´ çš„ç±»å‹")])]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" FunctionComponent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ClassComponent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" IndeterminateComponent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Before we know whether it is function or class")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HostRoot "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Root of a host tree. Could be nested inside another node.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HostPortal "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// A subtree. Could be an entry point to a different renderer.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HostComponent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HostText "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Fragment "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Mode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ContextConsumer "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ContextProvider "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ForwardRef "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("11")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Profiler "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" SuspenseComponent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("13")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" MemoComponent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("14")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" SimpleMemoComponent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("15")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" LazyComponent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" IncompleteClassComponent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" DehydratedSuspenseComponent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" EventComponent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("19")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" EventTarget "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" SuspenseListComponent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("21")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"effecttag"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#effecttag"}},[t._v("#")]),t._v(" "),s("strong",[t._v("EffectTag")])]),t._v(" "),s("blockquote",[s("p",[t._v("fiber å¯¹è±¡çš„ effectTag å±æ€§å€¼ï¼Œæ¯ä¸€ä¸ª fiber èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªå’Œå®ƒç›¸å…³è”çš„ effectTag å€¼ã€‚æˆ‘ä»¬æŠŠä¸èƒ½åœ¨ render é˜¶æ®µå®Œæˆçš„ä¸€äº› work ç§°ä¹‹ä¸ºå‰¯ä½œç”¨ï¼ŒReact ç½—åˆ—äº†å¯èƒ½å­˜åœ¨çš„å„ç±»å‰¯ä½œç”¨")])]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" NoEffect "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*              */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b000000000000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" PerformedWork "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*         */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b000000000001")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Placement "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*             */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b000000000010")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Update "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*                */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b000000000100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" PlacementAndUpdate "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*    */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b000000000110")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Deletion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*              */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b000000001000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ContentReset "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*          */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b000000010000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Callback "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*              */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b000000100000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" DidCapture "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*            */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b000001000000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Ref "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*                   */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b000010000000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Snapshot "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*              */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b000100000000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Passive "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*               */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b001000000000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" LifecycleEffectMask "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*   */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b001110100100")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HostEffectMask "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*        */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b001111111111")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Incomplete "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*            */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b010000000000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ShouldCapture "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*         */")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0b100000000000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"reconciliation-å’Œ-scheduling"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#reconciliation-å’Œ-scheduling"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Reconciliation å’Œ Scheduling")])]),t._v(" "),s("blockquote",[s("p",[t._v("åè°ƒï¼ˆReconciliationï¼‰ï¼šæ ¹æ® diff ç®—æ³•æ¥æ¯”è¾ƒè™šæ‹Ÿ DOMï¼Œä»è€Œå¯ä»¥ç¡®è®¤å“ªäº›éƒ¨åˆ†çš„ React å…ƒç´ éœ€è¦æ›´æ”¹ã€‚")]),t._v(" "),s("p",[t._v("è°ƒåº¦ï¼ˆSchedulingï¼‰ï¼šç¡®å®šåœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ work çš„è¿‡ç¨‹ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"current-æ ‘å’Œ-workinprogress-æ ‘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#current-æ ‘å’Œ-workinprogress-æ ‘"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Current æ ‘å’Œ WorkInProgress æ ‘")])]),t._v(" "),s("p",[t._v("é¦–æ¬¡æ¸²æŸ“ä¹‹åï¼ŒReact ä¼šç”Ÿæˆä¸€ä¸ªå¯¹åº”äº UI æ¸²æŸ“çš„ fiber æ ‘ï¼Œç§°ä¹‹ä¸º current æ ‘ã€‚")]),t._v(" "),s("p",[t._v("å½“ React éå† current æ ‘æ—¶ï¼Œå®ƒä¼šä¸ºæ¯ä¸€ä¸ªå­˜åœ¨çš„ fiber èŠ‚ç‚¹åˆ›å»ºäº†ä¸€ä¸ªæ›¿ä»£èŠ‚ç‚¹ï¼Œè¿™äº›èŠ‚ç‚¹æ„æˆä¸€ä¸ª workInProgress æ ‘ã€‚")]),t._v(" "),s("p",[t._v("ğŸ’¡ React åœ¨è°ƒç”¨ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°æ—¶å°±æ˜¯é€šè¿‡åˆ¤æ–­æ˜¯å¦å­˜åœ¨ current æ¥åŒºåˆ†ä½•æ—¶æ‰§è¡Œ componentDidMount å’Œ componentDidUpdate")]),t._v(" "),s("p",[t._v("ğŸ’¡ æ‰€æœ‰å‘ç”Ÿ work çš„åœ°æ–¹éƒ½æ˜¯åœ¨ workInProgress æ ‘ä¸­æ‰§è¡Œï¼Œå¦‚æœè¯¥æ ‘è¿˜æœªåˆ›å»ºï¼Œåˆ™ä¼šåˆ›å»ºä¸€ä¸ª current æ ‘çš„å‰¯æœ¬ï¼Œä½œä¸º workInProgress æ ‘ã€‚å½“ workInProgress æ ‘è¢«æäº¤åå°†ä¼šåœ¨ commit é˜¶æ®µçš„æŸä¸€å­é˜¶æ®µè¢«æ›¿æ¢æˆä¸º current æ ‘ã€‚")]),t._v(" "),s("p",[s("strong",[t._v("ğŸ¤”ï¸ä¸ºä»€ä¹ˆè¦å¢åŠ è¿™ä¸¤ä¸ªæ ‘ğŸŒ²ï¼Ÿ")])]),t._v(" "),s("p",[t._v("é¿å…æ›´æ–°çš„ä¸¢å¤±ã€‚æ¯”å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åªå¢åŠ æ›´æ–°åˆ° workInProgress æ ‘ï¼Œå½“ workInProgress æ ‘é€šè¿‡ä» current æ ‘ä¸­å…‹éš†è€Œé‡æ–°å¼€å§‹æ—¶ï¼Œä¸€äº›æ›´æ–°å¯èƒ½ä¼šä¸¢å¤±ã€‚åŒæ ·çš„ï¼Œå¦‚æœæˆ‘ä»¬åªå¢åŠ æ›´æ–°åˆ° current æ ‘ï¼Œå½“ workInProgress æ ‘è¢«æäº¤åä¼šè¢«æ›¿æ¢ä¸º current æ ‘ï¼Œæ›´æ–°ä¹Ÿä¼šè¢«ä¸¢å¤±ã€‚é€šè¿‡åœ¨ä¸¤ä¸ªé˜Ÿåˆ—éƒ½ä¿æŒæ›´æ–°ï¼Œå¯ä»¥ç¡®ä¿æ›´æ–°å§‹ç»ˆæ˜¯ä¸‹ä¸€ä¸ª workInProgress æ ‘çš„ä¸€éƒ¨åˆ†ã€‚å¹¶ä¸”ï¼Œå› ä¸º workInProgress æ ‘è¢«æäº¤æˆä¸º current æ ‘ï¼Œå¹¶ä¸ä¼šå‡ºç°ç›¸åŒçš„æ›´æ–°è€Œè¢«é‡å¤åº”ç”¨ä¸¤æ¬¡çš„æƒ…å†µã€‚")]),t._v(" "),s("h3",{attrs:{id:"effects-list"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#effects-list"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Effects list")])]),t._v(" "),s("blockquote",[s("p",[t._v("ä¸€ä¸ªå­˜å‚¨ effectTag å‰¯ä½œç”¨åˆ—è¡¨å®¹å™¨ã€‚å®ƒæ˜¯ç”± fiber èŠ‚ç‚¹å’ŒæŒ‡é’ˆ nextEffect æ„æˆçš„å•é“¾è¡¨ç»“æ„ï¼Œè¿™å…¶ä¸­è¿˜åŒ…æ‹¬ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ firstEffectï¼Œå’Œæœ€åä¸€ä¸ªèŠ‚ç‚¹ lastEffectã€‚")])]),t._v(" "),s("p",[t._v("ğŸ’¡ React é‡‡ç”¨æ·±åº¦ä¼˜å…ˆæœç´¢ç®—æ³•ã€‚")]),t._v(" "),s("p",[t._v("åœ¨ render é˜¶æ®µéå† fiber æ ‘æ—¶ï¼ŒæŠŠæ¯ä¸€ä¸ªæœ‰å‰¯ä½œç”¨çš„ fiber ç­›é€‰å‡ºæ¥ï¼Œæœ€åæ„å»ºç”Ÿæˆä¸€ä¸ªåªå¸¦å‰¯ä½œç”¨çš„ effect list é“¾è¡¨ã€‚\nåœ¨ commit é˜¶æ®µï¼ŒReact æ‹¿åˆ° effect list æ•°æ®åï¼Œé€šè¿‡éå† effect listï¼Œå¹¶æ ¹æ®æ¯ä¸€ä¸ª effect èŠ‚ç‚¹çš„ effectTag ç±»å‹ï¼Œä»è€Œå¯¹ç›¸åº”çš„ DOM æ ‘æ‰§è¡Œæ›´æ”¹ã€‚")]),t._v(" "),s("h2",{attrs:{id:"renderé˜¶æ®µã€éå†-æ”¶é›†éœ€è¦å˜æ›´çš„èŠ‚ç‚¹ã€‘"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#renderé˜¶æ®µã€éå†-æ”¶é›†éœ€è¦å˜æ›´çš„èŠ‚ç‚¹ã€‘"}},[t._v("#")]),t._v(" Renderé˜¶æ®µã€éå†-æ”¶é›†éœ€è¦å˜æ›´çš„èŠ‚ç‚¹ã€‘")]),t._v(" "),s("h3",{attrs:{id:"å›¾è§£"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å›¾è§£"}},[t._v("#")]),t._v(" å›¾è§£")]),t._v(" "),s("p",[s("img",{attrs:{src:"React-Fibe%206c670/Untitled%201.png",alt:"Untitled"}})]),t._v(" "),s("blockquote",[s("p",[t._v("æ­¤é˜¶æ®µä¼šæ‰¾å‡ºæ‰€æœ‰èŠ‚ç‚¹çš„å˜æ›´ï¼Œå¦‚èŠ‚ç‚¹æ–°å¢ã€åˆ é™¤ã€å±æ€§å˜æ›´ç­‰ï¼Œè¿™äº›å˜æ›´ react ç»Ÿç§°ä¸ºå‰¯ä½œç”¨ï¼ˆeffectï¼‰ï¼Œæ­¤é˜¶æ®µä¼šæ„å»ºä¸€æ£µ"),s("code",[t._v("Fiber tree")]),t._v("ï¼Œä»¥è™šæ‹ŸdomèŠ‚ç‚¹ä¸ºç»´åº¦å¯¹ä»»åŠ¡è¿›è¡Œæ‹†åˆ†ï¼Œå³ä¸€ä¸ªè™šæ‹ŸdomèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªä»»åŠ¡ï¼Œæœ€åäº§å‡ºçš„ç»“æœæ˜¯"),s("code",[t._v("effect list")]),t._v("ï¼Œä»ä¸­å¯ä»¥çŸ¥é“å“ªäº›èŠ‚ç‚¹æ›´æ–°ã€å“ªäº›èŠ‚ç‚¹å¢åŠ ã€å“ªäº›èŠ‚ç‚¹åˆ é™¤äº†ã€‚")])]),t._v(" "),s("h3",{attrs:{id:"éå†æµç¨‹"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#éå†æµç¨‹"}},[t._v("#")]),t._v(" éå†æµç¨‹")]),t._v(" "),s("p",[s("code",[t._v("React Fiber")]),t._v("é¦–å…ˆæ˜¯å°†è™šæ‹ŸDOMæ ‘è½¬åŒ–ä¸º"),s("code",[t._v("Fiber tree")]),t._v("ï¼Œå› æ­¤æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰"),s("code",[t._v("child")]),t._v("ã€"),s("code",[t._v("sibling")]),t._v("ã€"),s("code",[t._v("return")]),t._v("å±æ€§ï¼Œéå†"),s("code",[t._v("Fiber tree")]),t._v("æ—¶é‡‡ç”¨çš„æ˜¯ååºéå†æ–¹æ³•ï¼š")]),t._v(" "),s("p",[s("img",{attrs:{src:"React-Fibe%206c670/Untitled%202.png",alt:"Untitled"}})]),t._v(" "),s("ol",[s("li",[t._v("ä»é¡¶ç‚¹å¼€å§‹éå†")]),t._v(" "),s("li",[t._v("å¦‚æœæœ‰å¤§å„¿å­ï¼Œå…ˆéå†å¤§å„¿å­ï¼›å¦‚æœæ²¡æœ‰å¤§å„¿å­ï¼Œåˆ™è¡¨ç¤ºéå†å®Œæˆ")]),t._v(" "),s("li",[t._v("å¤§å„¿å­\n"),s("ol",[s("li",[t._v("å¦‚æœæœ‰å¼Ÿå¼Ÿï¼Œåˆ™è¿”å›å¼Ÿå¼Ÿï¼Œè·³åˆ°2")]),t._v(" "),s("li",[t._v("å¦‚æœæ²¡æœ‰å¼Ÿå¼Ÿï¼Œåˆ™è¿”å›çˆ¶èŠ‚ç‚¹ï¼Œå¹¶æ ‡å¿—å®Œæˆçˆ¶èŠ‚ç‚¹éå†ï¼Œè·³åˆ°2")]),t._v(" "),s("li",[t._v("å¦‚æœæ²¡æœ‰çˆ¶èŠ‚ç‚¹åˆ™æ ‡å¿—éå†ç»“æŸ")])])])]),t._v(" "),s("h3",{attrs:{id:"æ”¶é›†effect-list"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ”¶é›†effect-list"}},[t._v("#")]),t._v(" æ”¶é›†effect list")]),t._v(" "),s("blockquote",[s("p",[t._v("é€šè¿‡æ¯ä¸ªèŠ‚ç‚¹æ›´æ–°ç»“æŸæ—¶å‘ä¸Šå½’å¹¶"),s("code",[t._v("effect list")]),t._v("æ¥æ”¶é›†ä»»åŠ¡ç»“æœï¼Œæœ€åæ ¹èŠ‚ç‚¹çš„"),s("code",[t._v("effect list")]),t._v("é‡Œå°±è®°å½•äº†åŒ…æ‹¬äº†æ‰€æœ‰éœ€è¦å˜æ›´çš„ç»“æœã€‚")])]),t._v(" "),s("p",[s("img",{attrs:{src:"React-Fibe%206c670/Untitled%203.png",alt:"Untitled"}})]),t._v(" "),s("p",[s("code",[t._v("firstEffect")]),t._v(": å­æ ‘ä¸­ç¬¬ä¸€ä¸ªside effect\n"),s("code",[t._v("lastEffect")]),t._v(": å­æ ‘ä¸­æœ€åä¸€ä¸ªside effect")]),t._v(" "),s("p",[t._v("æ­¥éª¤ä¸ºï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å¦‚æœå½“å‰èŠ‚ç‚¹éœ€è¦æ›´æ–°ï¼Œåˆ™æ‰“"),s("code",[t._v("tag")]),t._v("æ›´æ–°å½“å‰èŠ‚ç‚¹çŠ¶æ€ï¼ˆprops, state, contextç­‰ï¼‰ä¸ºæ¯ä¸ªå­èŠ‚ç‚¹åˆ›å»ºfiberã€‚")]),t._v(" "),s("li",[t._v("å¦‚æœæ²¡æœ‰äº§ç”Ÿ"),s("code",[t._v("child fiber")]),t._v("ï¼Œåˆ™ç»“æŸè¯¥èŠ‚ç‚¹ï¼ŒæŠŠ"),s("code",[t._v("effect list")]),t._v("å½’å¹¶åˆ°"),s("code",[t._v("return")]),t._v("ï¼ŒæŠŠæ­¤èŠ‚ç‚¹çš„"),s("code",[t._v("sibling")]),t._v("èŠ‚ç‚¹ä½œä¸ºä¸‹ä¸€ä¸ªéå†èŠ‚ç‚¹ï¼›å¦åˆ™æŠŠ"),s("code",[t._v("child")]),t._v("èŠ‚ç‚¹ä½œä¸ºä¸‹ä¸€ä¸ªéå†èŠ‚ç‚¹")]),t._v(" "),s("li",[t._v("å¦‚æœæœ‰å‰©ä½™æ—¶é—´ï¼Œåˆ™å¼€å§‹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦åˆ™ç­‰ä¸‹ä¸€æ¬¡ä¸»çº¿ç¨‹ç©ºé—²å†å¼€å§‹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹")]),t._v(" "),s("li",[t._v("å¦‚æœæ²¡æœ‰ä¸‹ä¸€ä¸ªèŠ‚ç‚¹äº†ï¼Œè¿›å…¥"),s("code",[t._v("pendingCommit")]),t._v("çŠ¶æ€ï¼Œæ­¤æ—¶"),s("code",[t._v("effect list")]),t._v("æ”¶é›†å®Œæ¯•ï¼Œç»“æŸã€‚")])]),t._v(" "),s("p",[t._v("æ€»ç»“ï¼š")]),t._v(" "),s("ul",[s("li",[t._v("å³è…¿åäº†ï¼Œå°±æŠŠè¿™ä¸ªå³è…¿æ‰“ä¸ªtagæ ‡ç¤ºï¼Œ\n"),s("ul",[s("li",[t._v("åˆ¤æ–­æ˜¯å¦æœ‰è„šï¼Œå¦‚æœæœ‰ï¼Œå°±æ‰“ä¸ªchild fiber")]),t._v(" "),s("li",[t._v("åˆ¤æ–­æ˜¯å¦æœ‰è„šè¶¾å¤´ï¼Œéå†è„šè¶¾å¤´æ‰“fiber")])])]),t._v(" "),s("li",[t._v("å¦‚æœå³è…¿æ²¡æœ‰è„šï¼Œå°±è¿”å›æ‰“äº†tagçš„å³è…¿ï¼Œç„¶åæ¢åˆ°å·¦è…¿ç»§ç»­")]),t._v(" "),s("li",[t._v("ä¸»çº¿ç¨‹å°±æ˜¯å¤§è„‘ï¼Œå¤§è„‘åäº†å°±èµ¶ç´§æ²»å¤§è„‘ğŸ§ ï¼Œæ²»å¥½äº†å†å›æ¥æ²»è…¿ğŸ¦µ")])]),t._v(" "),s("h2",{attrs:{id:"commité˜¶æ®µ"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#commité˜¶æ®µ"}},[t._v("#")]),t._v(" Commité˜¶æ®µ")]),t._v(" "),s("blockquote",[s("p",[t._v("éœ€è¦å°†ä¸Šé˜¶æ®µè®¡ç®—å‡ºæ¥çš„éœ€è¦å¤„ç†çš„å‰¯ä½œç”¨ä¸€æ¬¡æ€§æ‰§è¡Œï¼Œæ­¤é˜¶æ®µä¸èƒ½æš‚åœï¼Œå¦åˆ™ä¼šå‡ºç°UIæ›´æ–°ä¸è¿ç»­çš„ç°è±¡ã€‚æ­¤é˜¶æ®µéœ€è¦æ ¹æ®"),s("code",[t._v("effect list")]),t._v("\nï¼Œå°†æ‰€æœ‰æ›´æ–°éƒ½ commit åˆ°DOMæ ‘ä¸Šã€‚")])]),t._v(" "),s("h3",{attrs:{id:"æ ¹æ®ä¸€ä¸ªfiberçš„effect-listæ›´æ–°è§†å›¾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ ¹æ®ä¸€ä¸ªfiberçš„effect-listæ›´æ–°è§†å›¾"}},[t._v("#")]),t._v(" æ ¹æ®ä¸€ä¸ªfiberçš„effect listæ›´æ–°è§†å›¾")]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("commitWork")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("currentFiber")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("currentFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" returnFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" currentFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("return\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" returnDOM "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" returnFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stateNode "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// çˆ¶èŠ‚ç‚¹å…ƒç´ ")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("effectTag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("INSERT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœå½“å‰fiberçš„effectTagæ ‡è¯†ä½INSERTï¼Œåˆ™ä»£è¡¨å…¶æ˜¯éœ€è¦æ’å…¥çš„èŠ‚ç‚¹")]),t._v("\n    returnDOM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stateNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("effectTag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DELETE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœå½“å‰fiberçš„effectTagæ ‡è¯†ä½DELETEï¼Œåˆ™ä»£è¡¨å…¶æ˜¯éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹")]),t._v("\n    returnDOM"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stateNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("effectTag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UPDATE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœå½“å‰fiberçš„effectTagæ ‡è¯†ä½UPDATEï¼Œåˆ™ä»£è¡¨å…¶æ˜¯éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("type "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ELEMENT_TEXT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("alternate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" currentFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        currentFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stateNode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("textContent "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" currentFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("props"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  currentFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("effectTag "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"æ ¹æ®å…¨éƒ¨-fiber-çš„-effect-list-æ›´æ–°è§†å›¾"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#æ ¹æ®å…¨éƒ¨-fiber-çš„-effect-list-æ›´æ–°è§†å›¾"}},[t._v("#")]),t._v(" "),s("strong",[t._v("æ ¹æ®å…¨éƒ¨ fiber çš„ effect list æ›´æ–°è§†å›¾")])]),t._v(" "),s("p",[t._v("é€’å½’å‡½æ•°ï¼Œä»æ ¹èŠ‚ç‚¹å‡ºå‘ï¼Œæ ¹æ®"),s("code",[t._v("effect list")]),t._v("å®Œæˆå…¨éƒ¨æ›´æ–°ï¼š")]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("commitRoot")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" currentFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" workInProgressRoot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("firstEffect\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitWork")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("currentFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    currentFiber "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" currentFiber"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextEffect\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  currentRoot "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" workInProgressRoot "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æŠŠå½“å‰æ¸²æŸ“æˆåŠŸçš„æ ¹fiberèµ‹ç»™currentRoot")]),t._v("\n  workInProgressRoot "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"å®Œæˆè§†å›¾æ›´æ–°"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#å®Œæˆè§†å›¾æ›´æ–°"}},[t._v("#")]),t._v(" "),s("strong",[t._v("å®Œæˆè§†å›¾æ›´æ–°")])]),t._v(" "),s("p",[t._v("å®šä¹‰å¾ªç¯æ‰§è¡Œå·¥ä½œï¼Œå½“è®¡ç®—å®Œæˆæ¯ä¸ª fiber çš„"),s("code",[t._v("effect list")]),t._v("åï¼Œè°ƒç”¨ commitRoot å®Œæˆè§†å›¾æ›´æ–°")]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("workloop")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("deadline")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" shouldYield "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ˜¯å¦éœ€è¦è®©å‡ºæ§åˆ¶æƒ")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextUnitOfWork "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("shouldYield"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    nextUnitOfWork "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("performUnitOfWork")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("nextUnitOfWork"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    shouldYield "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" deadline"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeRemaining")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// å¦‚æœæ‰§è¡Œå®Œä»»åŠ¡åï¼Œå‰©ä½™æ—¶é—´å°äº1msï¼Œåˆ™éœ€è¦è®©å‡ºæ§åˆ¶æƒç»™æµè§ˆå™¨")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("nextUnitOfWork "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" workInProgressRoot"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'renderé˜¶æ®µç»“æŸ'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("commitRoot")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// æ²¡æœ‰ä¸‹ä¸€ä¸ªä»»åŠ¡äº†ï¼Œæ ¹æ®effect listç»“æœæ‰¹é‡æ›´æ–°è§†å›¾")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// è¯·æ±‚æµè§ˆå™¨è¿›è¡Œå†æ¬¡è°ƒåº¦")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestIdleCallback")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("workloop"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("timeout")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);